<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Roblox Private Server Manager</title>
<style>
  /* Dark theme */
  body {
    margin:0; padding:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #121212; color: #eee;
  }
  #login, #app {
    max-width: 700px; margin: 2rem auto; padding: 1rem;
  }
  button {
    background-color: #3a3a3a;
    border: none; border-radius: 4px; color: #eee; padding: 0.6rem 1.2rem;
    cursor: pointer; transition: background-color 0.3s;
    margin: 0 0.4rem 0.4rem 0;
    font-size: 1rem;
  }
  button:hover {
    background-color: #555;
  }
  h1 {
    margin-bottom: 1rem;
  }
  .hidden {
    display: none !important;
  }
  /* Simple input style */
  input[type="text"], input[type="password"], input[type="url"] {
    width: 100%; padding: 0.5rem; margin-bottom: 0.8rem;
    background: #222; border: none; border-radius: 4px; color: #eee;
    font-size: 1rem;
  }
  /* Server list items */
  .server-item {
    background: #222; border-radius: 6px; padding: 0.7rem 1rem; margin-bottom: 0.8rem;
    display: flex; justify-content: space-between; align-items: center;
    flex-wrap: wrap;
  }
  .server-info {
    flex-grow: 1; min-width: 200px;
    word-break: break-word;
  }
  .btn-group button {
    font-size: 0.9rem;
  }
  #switchAccountBtn {
    float: right;
    background-color: #2777f7;
  }
</style>
</head>
<body>

<div id="login">
  <h1>Roblox Private Server Manager</h1>
  <button id="googleSignInBtn">Sign in with Google</button>
</div>

<div id="app" class="hidden">
  <button id="switchAccountBtn" title="Switch Google Account">Switch Account</button>
  <h1>Your Private Servers</h1>
  
  <div>
    <label for="serverLinkInput">Private Server Link</label>
    <input type="url" id="serverLinkInput" placeholder="Enter Roblox private server link" />
    <label for="pinInput">4-digit PIN</label>
    <input type="password" id="pinInput" maxlength="4" placeholder="Enter your 4-digit PIN" />
    <button id="addServerBtn">Add Server</button>
  </div>

  <div id="serversList"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDM9zEhD6qnur2RY4zK5ZQ_TbJVkESsnRw",
    authDomain: "roblox-server-manager.firebaseapp.com",
    projectId: "roblox-server-manager",
    storageBucket: "roblox-server-manager.firebasestorage.app",
    messagingSenderId: "223404001099",
    appId: "1:223404001099:web:4eee47729061301c158ace",
    measurementId: "G-G9PV6GD2KN"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const loginDiv = document.getElementById("login");
  const appDiv = document.getElementById("app");
  const googleSignInBtn = document.getElementById("googleSignInBtn");
  const switchAccountBtn = document.getElementById("switchAccountBtn");
  const addServerBtn = document.getElementById("addServerBtn");
  const serverLinkInput = document.getElementById("serverLinkInput");
  const pinInput = document.getElementById("pinInput");
  const serversList = document.getElementById("serversList");

  let currentUser = null;
  let userPin = null;
  let servers = [];

  function updateUI(user) {
    if (user) {
      loginDiv.classList.add("hidden");
      appDiv.classList.remove("hidden");
      switchAccountBtn.style.display = "inline-block";
      currentUser = user;
      servers = [];
      renderServers();
      userPin = null;
    } else {
      loginDiv.classList.remove("hidden");
      appDiv.classList.add("hidden");
      switchAccountBtn.style.display = "none";
      currentUser = null;
      servers = [];
    }
  }

  function renderServers() {
    serversList.innerHTML = "";
    if (servers.length === 0) {
      serversList.innerHTML = "<p style='color:#999;'>No private servers added yet.</p>";
      return;
    }
    servers.forEach((srv, i) => {
      const div = document.createElement("div");
      div.className = "server-item";

      const info = document.createElement("div");
      info.className = "server-info";
      info.textContent = srv.link;

      const btnGroup = document.createElement("div");
      btnGroup.className = "btn-group";

      const joinBtn = document.createElement("button");
      joinBtn.textContent = "Join";
      joinBtn.onclick = () => window.open(srv.link, "_blank", "noopener");

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Delete";
      deleteBtn.className = "danger";
      deleteBtn.onclick = () => {
        const pin = prompt("Enter your 4-digit PIN to delete this server:");
        if (pin === userPin) {
          servers.splice(i, 1);
          renderServers();
        } else {
          alert("Incorrect PIN.");
        }
      };

      btnGroup.appendChild(joinBtn);
      btnGroup.appendChild(deleteBtn);

      div.appendChild(info);
      div.appendChild(btnGroup);
      serversList.appendChild(div);
    });
  }

  googleSignInBtn.onclick = async () => {
    try {
      await signInWithPopup(auth, provider.setCustomParameters({ prompt: "select_account" }));
    } catch (e) {
      alert("Sign in failed: " + e.message);
    }
  };

  switchAccountBtn.onclick = async () => {
    try {
      await signInWithPopup(auth, provider.setCustomParameters({ prompt: "select_account" }));
    } catch (e) {
      alert("Switch account failed: " + e.message);
    }
  };

  onAuthStateChanged(auth, (user) => {
    updateUI(user);
  });

  addServerBtn.onclick = () => {
    const link = serverLinkInput.value.trim();
    const pin = pinInput.value.trim();
    if (!link) {
      alert("Please enter a private server link.");
      return;
    }
    if (!pin || pin.length !== 4 || !/^\d{4}$/.test(pin)) {
      alert("Please enter a valid 4-digit PIN.");
      return;
    }
    if (!userPin) {
      userPin = pin;
    } else if (pin !== userPin) {
      alert("Incorrect PIN.");
      return;
    }
    if (servers.length >= 10) {
      alert("Maximum 10 servers allowed.");
      return;
    }
    servers.push({ link });
    serverLinkInput.value = "";
    pinInput.value = "";
    renderServers();
  };
</script>

</body>
</html>
